<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ag Market Feed | AGSIST</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0d0d0f;
            --card: #141418;
            --card-hover: #1a1a1f;
            --border: #2a2a32;
            --text: #e8e8ec;
            --dim: #8a8a94;
            --accent: #e6b042;
            --grain: #e6b042;
            --weather: #4a9eff;
            --markets: #22c55e;
            --farm: #a855f7;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* NAV */
        nav {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--accent);
            text-decoration: none;
        }
        .nav-links {
            display: flex;
            gap: 24px;
        }
        .nav-links a {
            color: var(--dim);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.2s;
        }
        .nav-links a:hover, .nav-links a.active {
            color: var(--accent);
        }
        
        /* MAIN */
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px 16px;
        }
        
        .page-header {
            margin-bottom: 24px;
            text-align: center;
        }
        .page-header h1 {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 8px;
        }
        .page-header p {
            color: var(--dim);
            font-size: 0.9rem;
        }
        
        /* FILTERS */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .filter-btn {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--dim);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--text);
        }
        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #000;
        }
        .filter-btn[data-filter="grain"].active { background: var(--grain); }
        .filter-btn[data-filter="weather"].active { background: var(--weather); }
        .filter-btn[data-filter="markets"].active { background: var(--markets); }
        .filter-btn[data-filter="farm"].active { background: var(--farm); }
        
        /* STATUS */
        .feed-status {
            text-align: center;
            color: var(--dim);
            font-size: 0.8rem;
            margin-bottom: 16px;
        }
        .feed-status .live { color: #22c55e; }
        
        /* TWEET CARDS */
        .feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .tweet {
            display: block;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s ease;
        }
        .tweet:hover {
            background: var(--card-hover);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        
        .tweet-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .tweet-author {
            flex: 1;
            min-width: 0;
        }
        .tweet-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text);
        }
        .tweet-handle {
            color: var(--dim);
            font-size: 0.8rem;
        }
        .tweet-tag {
            font-size: 0.65rem;
            padding: 4px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .tweet-tag.grain { background: rgba(230, 176, 66, 0.2); color: var(--grain); }
        .tweet-tag.weather { background: rgba(74, 158, 255, 0.2); color: var(--weather); }
        .tweet-tag.markets { background: rgba(34, 197, 94, 0.2); color: var(--markets); }
        .tweet-tag.farm { background: rgba(168, 85, 247, 0.2); color: var(--farm); }
        
        .tweet-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text);
            margin-bottom: 12px;
            word-wrap: break-word;
        }
        .tweet-text .mention { color: var(--weather); }
        .tweet-text .ticker { color: var(--markets); font-weight: 600; }
        .tweet-text .link { color: var(--accent); }
        
        /* Images */
        .tweet-images {
            display: grid;
            gap: 4px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        .tweet-images.img-1 { grid-template-columns: 1fr; }
        .tweet-images.img-2, .tweet-images.img-3, .tweet-images.img-4 { grid-template-columns: 1fr 1fr; }
        .tweet-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--border);
        }
        .tweet-images.img-1 .tweet-img { height: 300px; }
        
        .tweet-video-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.1);
            color: var(--dim);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            margin-bottom: 12px;
        }
        
        .tweet-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--dim);
            font-size: 0.75rem;
        }
        .tweet-time { color: var(--dim); }
        .tweet-link {
            color: var(--accent);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .tweet:hover .tweet-link { opacity: 1; }
        
        .tweet.rt {
            opacity: 0.85;
            border-left: 3px solid var(--dim);
        }
        
        /* Loading / Error */
        .feed-loading, .feed-error {
            text-align: center;
            padding: 60px 20px;
            color: var(--dim);
        }
        .feed-loading::before {
            content: "â³";
            display: block;
            font-size: 2rem;
            margin-bottom: 12px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .feed-error::before {
            content: "âš ï¸";
            display: block;
            font-size: 2rem;
            margin-bottom: 12px;
        }
        
        /* MOBILE */
        @media (max-width: 600px) {
            .nav-links { gap: 12px; font-size: 0.75rem; }
            .page-header h1 { font-size: 1.4rem; }
            .tweet { padding: 12px; }
            .tweet-images.img-1 .tweet-img { height: 200px; }
            .tweet-img { height: 140px; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-inner">
            <a href="index.html" class="logo">AGSIST</a>
            <div class="nav-links">
                <a href="index.html">Dashboard</a>
                <a href="fastfacts.html">Fast Facts</a>
                <a href="learn.html">Learn</a>
                <a href="news.html" class="active">News</a>
            </div>
        </div>
    </nav>
    
    <main>
        <div class="page-header">
            <h1>ğŸ“¡ Ag Market Feed</h1>
            <p>Live commentary from grain analysts, weather experts, and farm policy voices</p>
        </div>
        
        <div class="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="grain">ğŸŒ¾ Grain</button>
            <button class="filter-btn" data-filter="weather">ğŸŒ¦ï¸ Weather</button>
            <button class="filter-btn" data-filter="markets">ğŸ“ˆ Markets</button>
            <button class="filter-btn" data-filter="farm">ğŸšœ Farm</button>
        </div>
        
        <div class="feed-status">
            <span id="feedStatus">Loading...</span>
        </div>
        
        <div class="feed" id="feed">
            <div class="feed-loading">Loading feed...</div>
        </div>
    </main>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIG - UPDATE THIS WITH YOUR GITHUB USERNAME AND REPO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const GITHUB_USER = 'dnilgis';  // â† Your GitHub username
        const GITHUB_REPO = 'agsist';   // â† Your repo name
        const GITHUB_BRANCH = 'main';   // â† Your branch (main or master)
        
        const FEED_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/data/tweets.json`;
        
        let allTweets = [];
        let currentFilter = 'all';
        
        const feed = document.getElementById('feed');
        const status = document.getElementById('feedStatus');
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HELPERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function timeAgo(dateStr) {
            const now = Date.now();
            const then = new Date(dateStr).getTime();
            if (isNaN(then)) return '';
            const diff = Math.floor((now - then) / 1000);
            
            if (diff < 60) return 'just now';
            if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
            if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
            if (diff < 604800) return Math.floor(diff / 86400) + 'd ago';
            return new Date(dateStr).toLocaleDateString();
        }
        
        function linkify(text) {
            if (!text) return '';
            text = text.replace(/(https?:\/\/[^\s]+)/g, '<span class="link">$1</span>');
            text = text.replace(/@(\w+)/g, '<span class="mention">@$1</span>');
            text = text.replace(/\$([A-Z]{1,5})\b/g, '<span class="ticker">$$$1</span>');
            return text;
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderImages(images) {
            if (!images || images.length === 0) return '';
            const count = Math.min(images.length, 4);
            const imgHtml = images.slice(0, 4).map(url => 
                `<img class="tweet-img" src="${url}" alt="" loading="lazy" onerror="this.style.display='none'">`
            ).join('');
            return `<div class="tweet-images img-${count}">${imgHtml}</div>`;
        }
        
        function renderTweets(tweets) {
            if (!tweets || tweets.length === 0) {
                feed.innerHTML = '<div class="feed-error">No tweets available yet.</div>';
                return;
            }
            
            feed.innerHTML = tweets.map(t => `
                <a class="tweet ${t.isRT ? 'rt' : ''}" href="${t.link}" target="_blank" rel="noopener" data-tag="${t.tag}">
                    <div class="tweet-header">
                        <div class="tweet-author">
                            <div class="tweet-name">${t.name || t.handle}</div>
                            <div class="tweet-handle">@${t.handle}</div>
                        </div>
                        <span class="tweet-tag ${t.tag}">${t.tag}</span>
                    </div>
                    <div class="tweet-text">${linkify(t.text)}</div>
                    ${renderImages(t.images)}
                    ${t.hasVideo ? '<div class="tweet-video-badge">â–¶ Contains video</div>' : ''}
                    <div class="tweet-footer">
                        <span class="tweet-time">${timeAgo(t.date)}</span>
                        <span class="tweet-link">View on ğ• â†’</span>
                    </div>
                </a>
            `).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FILTER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function applyFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            
            const filtered = filter === 'all' 
                ? allTweets 
                : allTweets.filter(t => t.tag === filter);
            
            renderTweets(filtered);
        }
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => applyFilter(btn.dataset.filter));
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FETCH
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function fetchFeed() {
            try {
                // Add cache buster
                const res = await fetch(FEED_URL + '?t=' + Date.now());
                
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                
                if (data.tweets && data.tweets.length > 0) {
                    allTweets = data.tweets;
                    const updated = data.updated ? new Date(data.updated).toLocaleTimeString() : 'Unknown';
                    status.innerHTML = `<span class="live">â—</span> ${data.count} posts â€¢ Updated ${updated}`;
                    applyFilter(currentFilter);
                } else {
                    status.textContent = 'Waiting for first fetch...';
                    feed.innerHTML = '<div class="feed-error">Feed is empty. The GitHub Action may not have run yet.<br><small>It runs every 30 minutes, or you can trigger it manually.</small></div>';
                }
            } catch (err) {
                console.error('Feed fetch error:', err);
                status.textContent = 'Feed unavailable';
                feed.innerHTML = `<div class="feed-error">Could not load feed.<br><small>${err.message}</small></div>`;
            }
        }
        
        // Initial fetch
        fetchFeed();
        
        // Refresh every 5 minutes
        setInterval(fetchFeed, 5 * 60 * 1000);
    </script>
</body>
</html>
