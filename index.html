<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KXCTD5Z9H"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-6KXCTD5Z9H');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGSIST | Free Live Ag Dashboard - Corn, Soybean, Wheat Prices</title>
    <meta name="description" content="Free live agricultural commodity prices, weather radar, and farm tools. Corn, soybean, wheat futures updated every 15 minutes. Built for farmers.">
    <meta name="keywords" content="corn prices today, soybean prices, wheat futures, ag commodity prices, farm dashboard, grain prices, livestock prices">
    <link rel="canonical" href="https://agsist.com/">
    
    <!-- Schema.org for Organization -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "AGSIST",
        "description": "Free agricultural dashboard with live commodity prices, farm calculators, and tools for farmers",
        "url": "https://agsist.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://agsist.com/tools.html",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "AGSIST",
        "url": "https://agsist.com",
        "logo": "https://agsist.com/icon-512.png",
        "description": "Agricultural technology tools built by farmers for farmers"
    }
    </script>
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#e6b042">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AGSIST">
    
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta property="og:title" content="AGSIST | Free Live Ag Dashboard">
    <meta property="og:description" content="Free live commodity prices, weather radar, and farm tools. Built for farmers.">
    <meta property="og:image" content="https://agsist.com/og-image.png">
    <meta property="og:url" content="https://agsist.com/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Shared Styles (nav, footer, variables) -->
    <link rel="stylesheet" href="/components/shared.css">
    
    <style>
        /* ============================================
           TICKER
           ============================================ */
        .ticker-wrap {
            background: #000;
            border-bottom: 1px solid var(--border);
            overflow: hidden;
            padding: 10px 0;
        }
        
        .ticker {
            display: flex;
            gap: 50px;
            animation: ticker-scroll 120s linear infinite;
            white-space: nowrap;
            width: max-content;
            padding: 0 20px;
        }
        
        .ticker:hover { animation-play-state: paused; }
        
        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        
        .ticker-item .label { color: var(--dim); font-weight: 500; }
        .ticker-item .price { color: var(--text); font-weight: 700; }
        .ticker-item .change { font-size: 0.9rem; font-weight: 600; }
        .ticker-item .change.up { color: var(--green); }
        .ticker-item .change.down { color: var(--red); }
        .ticker-item.news { color: var(--accent); max-width: 500px; overflow: hidden; text-overflow: ellipsis; }
        
        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* ============================================
           MAIN CONTENT
           ============================================ */
        main { max-width: 1600px; margin: 0 auto; padding: 12px; }
        .update-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; color: var(--dim); }
        
        /* ============================================
           PRICE CARDS
           ============================================ */
        .price-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px; }
        
        a.card-link { text-decoration: none; color: inherit; display: block; }
        a.card-link:hover .price-card, a.card-link:focus .price-card,
        a.card-link:hover .secondary-card, a.card-link:focus .secondary-card {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230,176,66,0.15);
        }
        
        .price-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .price-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230,176,66,0.15);
        }
        
        .price-card.featured {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--card) 0%, #1a1500 100%);
        }
        
        .price-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .price-label { font-size: 0.95rem; color: var(--text); font-weight: 600; }
        .price-contract { font-size: 0.9rem; color: var(--dim); background: var(--bg); padding: 3px 8px; border-radius: 4px; }
        .price-value { font-size: 2rem; font-weight: 700; margin-bottom: 4px; }
        .price-change { font-size: 0.95rem; font-weight: 600; }
        .price-change.up { color: var(--green); }
        .price-change.down { color: var(--red); }
        .price-meta { display: flex; gap: 12px; font-size: 0.875rem; color: var(--dim); margin-top: 4px; }
        .price-meta span { white-space: nowrap; }
        
        .range-bar { margin: 8px 0 4px; }
        .range-bar-label { display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--dim); margin-bottom: 4px; }
        .range-bar-track { height: 6px; background: var(--border); border-radius: 3px; position: relative; }
        .range-bar-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #4ade80, #e6b042, #ef4444); border-radius: 3px; opacity: 0.3; }
        .range-bar-marker { position: absolute; top: -2px; width: 10px; height: 10px; background: var(--accent); border-radius: 50%; transform: translateX(-50%); border: 2px solid var(--card); }
        
        .section-header { font-size: 0.9rem; color: var(--dim); text-transform: uppercase; letter-spacing: 0.05em; margin: 16px 0 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
        
        /* ============================================
           SECONDARY CARDS
           ============================================ */
        .secondary-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 12px; }
        .secondary-card { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 12px; cursor: pointer; transition: all 0.2s; position: relative; }
        .secondary-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(230,176,66,0.15); }
        .secondary-label { font-size: 0.9rem; color: var(--dim); margin-bottom: 6px; }
        .secondary-value { font-size: 1.25rem; font-weight: 700; }
        .secondary-change { font-size: 0.9rem; font-weight: 600; }
        .secondary-meta { display: flex; gap: 8px; font-size: 0.875rem; color: var(--dim); margin-top: 4px; }
        
        .range-bar-sm { margin-top: 6px; }
        .range-bar-sm .range-bar-track { height: 4px; background: var(--border); border-radius: 2px; position: relative; }
        .range-bar-sm .range-bar-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #4ade80, #e6b042, #ef4444); border-radius: 2px; opacity: 0.3; }
        .range-bar-sm .range-bar-marker { position: absolute; top: -2px; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; transform: translateX(-50%); border: 1px solid var(--card); }
        
        /* ============================================
           WEATHER & NEWS
           ============================================ */
        .weather-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .weather-card iframe { width: 100%; height: 420px; border: none; display: block; }
        
        .news-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; }
        .news-item { padding: 10px 0; border-bottom: 1px solid var(--border); }
        .news-item:last-child { border-bottom: none; padding-bottom: 0; }
        .news-item:first-child { padding-top: 0; }
        .news-item a { color: var(--text); text-decoration: none; font-size: 0.95rem; line-height: 1.6; display: block; }
        .news-item a:hover { color: var(--accent); }
        .news-source { font-size: 0.875rem; color: var(--dim); margin-top: 4px; }
        
        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (min-width: 768px) {
            main { padding: 16px 20px; }
            .price-grid { grid-template-columns: repeat(4, 1fr); }
            .secondary-grid { grid-template-columns: repeat(3, 1fr); }
            .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
            .weather-card iframe { height: 380px; }
        }
        
        @media (min-width: 1200px) {
            main { padding: 16px 24px; }
            .secondary-grid { grid-template-columns: repeat(6, 1fr); }
            .weather-card iframe { height: 400px; }
        }
        
        @media (max-width: 767px) {
            .price-grid { grid-template-columns: repeat(2, 1fr); }
            .price-value { font-size: 1.5rem; }
            .secondary-grid { grid-template-columns: repeat(2, 1fr); }
            .price-card, .secondary-card { min-height: 44px; }
        }
        
        /* ============================================
           UTILITIES
           ============================================ */
        input[type="text"], input[type="number"], input[type="email"], select, textarea { font-size: 16px !important; }
        a:focus, button:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
        html, body { overflow-x: hidden; }
        .loading { color: var(--dim); font-style: italic; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    </style>
</head>
<body>
    <!-- Header (loaded from /components/header.html) -->
    <div id="header"></div>
    
    <div class="ticker-wrap">
        <div class="ticker" id="ticker"></div>
    </div>
    
    <main>
        <h1 class="sr-only">AGSIST - Free Live Agricultural Commodity Prices, News & Weather Dashboard</h1>
        <div id="welcome-msg" style="margin-bottom:12px;font-size:0.95rem;color:var(--text)"></div>
        <div class="update-bar">
            <span>Last updated: <span id="update-time" class="loading">Loading...</span></span>
            <span>Data auto-refreshes</span>
        </div>
        
        <div class="price-grid" id="primary-prices">
            <a href="corn-prices.html" class="card-link">
                <div class="price-card featured" id="card-corn">
                    <div class="price-header">
                        <span class="price-label">üåΩ Corn</span>
                        <span class="price-contract" id="corn-contract">--</span>
                    </div>
                    <div class="price-value" id="corn-price">--</div>
                    <div class="price-change" id="corn-change">--</div>
                    <div class="price-meta"><span id="corn-prev">--</span><span id="corn-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="corn-range-low">--</span><span>52wk</span><span id="corn-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="corn-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <div class="price-card" id="card-corn-dec">
                <div class="price-header">
                    <span class="price-label">üåΩ Corn Harvest</span>
                    <span class="price-contract">Dec '26</span>
                </div>
                <div class="price-value" id="corn-dec-price">--</div>
                <div class="price-change" id="corn-dec-change">--</div>
                <div class="price-meta"><span id="corn-dec-prev">--</span><span id="corn-dec-symbol">--</span></div>
                <div class="range-bar">
                    <div class="range-bar-label"><span id="corn-dec-range-low">--</span><span>52wk</span><span id="corn-dec-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="corn-dec-marker" style="left:50%"></div></div>
                </div>
            </div>
            <a href="soybean-prices.html" class="card-link">
                <div class="price-card featured" id="card-soy">
                    <div class="price-header">
                        <span class="price-label">ü´ò Soybeans</span>
                        <span class="price-contract" id="soy-contract">--</span>
                    </div>
                    <div class="price-value" id="soy-price">--</div>
                    <div class="price-change" id="soy-change">--</div>
                    <div class="price-meta"><span id="soy-prev">--</span><span id="soy-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="soy-range-low">--</span><span>52wk</span><span id="soy-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="soy-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <div class="price-card" id="card-soy-nov">
                <div class="price-header">
                    <span class="price-label">ü´ò Beans Harvest</span>
                    <span class="price-contract">Nov '26</span>
                </div>
                <div class="price-value" id="soy-nov-price">--</div>
                <div class="price-change" id="soy-nov-change">--</div>
                <div class="price-meta"><span id="soy-nov-prev">--</span><span id="soy-nov-symbol">--</span></div>
                <div class="range-bar">
                    <div class="range-bar-label"><span id="soy-nov-range-low">--</span><span>52wk</span><span id="soy-nov-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="soy-nov-marker" style="left:50%"></div></div>
                </div>
            </div>
        </div>
        <div class="section-header">Livestock & Energy</div>
        <div class="secondary-grid" id="secondary-prices">
            <a href="wheat-prices.html" class="card-link">
                <div class="secondary-card">
                    <div class="secondary-label">üåæ Wheat</div>
                    <div class="secondary-value" id="wheat-price">--</div>
                    <div class="secondary-change" id="wheat-change">--</div>
                    <div class="secondary-meta"><span id="wheat-prev">--</span><span id="wheat-symbol">--</span></div>
                    <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="wheat-marker" style="left:50%"></div></div></div>
                </div>
            </a>
            <div class="secondary-card">
                <div class="secondary-label">üêÑ Live Cattle</div>
                <div class="secondary-value" id="cattle-price">--</div>
                <div class="secondary-change" id="cattle-change">--</div>
                <div class="secondary-meta"><span id="cattle-prev">--</span><span id="cattle-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="cattle-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üêÇ Feeder Cattle</div>
                <div class="secondary-value" id="feeder-price">--</div>
                <div class="secondary-change" id="feeder-change">--</div>
                <div class="secondary-meta"><span id="feeder-prev">--</span><span id="feeder-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="feeder-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üê∑ Lean Hogs</div>
                <div class="secondary-value" id="hogs-price">--</div>
                <div class="secondary-change" id="hogs-change">--</div>
                <div class="secondary-meta"><span id="hogs-prev">--</span><span id="hogs-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="hogs-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">ü•õ Class III Milk</div>
                <div class="secondary-value" id="milk-price">--</div>
                <div class="secondary-change" id="milk-change">--</div>
                <div class="secondary-meta"><span id="milk-prev">--</span><span id="milk-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="milk-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üõ¢Ô∏è Crude Oil</div>
                <div class="secondary-value" id="oil-price">--</div>
                <div class="secondary-change" id="oil-change">--</div>
                <div class="secondary-meta"><span id="oil-prev">--</span><span id="oil-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="oil-marker" style="left:50%"></div></div></div>
            </div>
        </div>
        
        <div class="section-header">Metals & Crypto</div>
        <div class="secondary-grid">
            <div class="secondary-card">
                <div class="secondary-label">ü•á Gold</div>
                <div class="secondary-value" id="gold-price">--</div>
                <div class="secondary-change" id="gold-change">--</div>
                <div class="secondary-meta"><span id="gold-prev">--</span><span id="gold-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="gold-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">ü•à Silver</div>
                <div class="secondary-value" id="silver-price">--</div>
                <div class="secondary-change" id="silver-change">--</div>
                <div class="secondary-meta"><span id="silver-prev">--</span><span id="silver-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="silver-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">ü™ô Bitcoin</div>
                <div class="secondary-value" id="btc-price">--</div>
                <div class="secondary-change" id="btc-change">--</div>
                <div class="secondary-meta"><span id="btc-prev">--</span><span id="btc-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="btc-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üíé Kaspa</div>
                <div class="secondary-value" id="kas-price">--</div>
                <div class="secondary-change" id="kas-change">--</div>
                <div class="secondary-meta"><span id="kas-prev">--</span><span id="kas-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="kas-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üìà S&P 500</div>
                <div class="secondary-value" id="sp500-price">--</div>
                <div class="secondary-change" id="sp500-change">--</div>
                <div class="secondary-meta"><span id="sp500-prev">--</span><span id="sp500-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="sp500-marker" style="left:50%"></div></div></div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üíµ USD Index</div>
                <div class="secondary-value" id="dxy-price">--</div>
                <div class="secondary-change" id="dxy-change">--</div>
                <div class="secondary-meta"><span id="dxy-prev">--</span><span id="dxy-symbol">--</span></div>
                <div class="range-bar-sm"><div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="dxy-marker" style="left:50%"></div></div></div>
            </div>
        </div>
        <div class="two-col">
            <div>
                <div class="section-header">üì∞ Ag News</div>
                <div class="news-card" id="news-feed" style="max-height:420px;overflow-y:auto">
                    <div class="news-item loading">Loading news...</div>
                </div>
            </div>
            <div>
                <div class="section-header">üå§Ô∏è Weather</div>
                <div id="forecast" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;font-size:0.95rem">
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:10px;text-align:center">
                        <div style="color:var(--dim);font-size:0.875rem">TODAY</div>
                        <div id="wx-today-icon" style="font-size:1.5rem;margin:4px 0">--</div>
                        <div id="wx-today-temp" style="font-weight:600">--</div>
                        <div id="wx-today-desc" style="font-size:0.875rem;color:var(--dim)">--</div>
                    </div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:10px;text-align:center">
                        <div style="color:var(--dim);font-size:0.875rem">TONIGHT</div>
                        <div id="wx-tonight-icon" style="font-size:1.5rem;margin:4px 0">--</div>
                        <div id="wx-tonight-temp" style="font-weight:600">--</div>
                        <div id="wx-tonight-desc" style="font-size:0.875rem;color:var(--dim)">--</div>
                    </div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:10px;text-align:center">
                        <div style="color:var(--dim);font-size:0.875rem">TOMORROW</div>
                        <div id="wx-tomorrow-icon" style="font-size:1.5rem;margin:4px 0">--</div>
                        <div id="wx-tomorrow-temp" style="font-weight:600">--</div>
                        <div id="wx-tomorrow-desc" style="font-size:0.875rem;color:var(--dim)">--</div>
                    </div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:10px;text-align:center">
                        <div style="color:var(--dim);font-size:0.875rem">TOM NIGHT</div>
                        <div id="wx-tomnight-icon" style="font-size:1.5rem;margin:4px 0">--</div>
                        <div id="wx-tomnight-temp" style="font-weight:600">--</div>
                        <div id="wx-tomnight-desc" style="font-size:0.875rem;color:var(--dim)">--</div>
                    </div>
                </div>
                <div class="weather-card">
                    <iframe src="https://embed.windy.com/embed2.html?lat=45.4&lon=-91.85&detailLat=45.4&detailLon=-91.85&width=650&height=350&zoom=7&level=surface&overlay=rain&product=ecmwf&menu=&message=true&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1" frameborder="0" title="Windy Weather"></iframe>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer (loaded from /components/footer.html) -->
    <div id="footer"></div>
    
    <!-- Load Components (header + footer) -->
    <script src="/components/load-components.js"></script>
    
    <script>
    async function loadData() {
        try {
            const res = await fetch('data/markets.json');
            if (!res.ok) throw new Error('Failed to load');
            const data = await res.json();
            
            document.getElementById('update-time').textContent = 
                new Date(data.updated).toLocaleString([], {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});
            document.getElementById('update-time').classList.remove('loading');
            
            const m = data.markets;
            
            const fmt = (val, unit) => {
                if (unit === '¬¢/bu') return (val / 100).toFixed(2);
                if (unit === '¬¢/lb') return val.toFixed(2);
                if (unit === '$/cwt') return val.toFixed(2);
                if (unit === '$/bbl') return val.toFixed(2);
                return val.toFixed(2);
            };
            
            const chgClass = (val) => val >= 0 ? 'up' : 'down';
            const chgSign = (val) => val >= 0 ? '+' : '';
            const rangePos = (price, low, high) => {
                if (!low || !high || high === low) return 50;
                return Math.min(100, Math.max(0, ((price - low) / (high - low)) * 100));
            };
            
            if (m.grains?.corn) {
                const c = m.grains.corn;
                document.getElementById('corn-contract').textContent = c.contract || 'Front';
                document.getElementById('corn-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('corn-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('corn-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('corn-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('corn-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('corn-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('corn-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('corn-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.corn_dec) {
                const c = m.grains.corn_dec;
                document.getElementById('corn-dec-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('corn-dec-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('corn-dec-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('corn-dec-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('corn-dec-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('corn-dec-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('corn-dec-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('corn-dec-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.soybeans) {
                const c = m.grains.soybeans;
                document.getElementById('soy-contract').textContent = c.contract || 'Front';
                document.getElementById('soy-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('soy-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('soy-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('soy-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('soy-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('soy-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('soy-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('soy-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.soybeans_nov) {
                const c = m.grains.soybeans_nov;
                document.getElementById('soy-nov-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('soy-nov-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('soy-nov-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('soy-nov-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('soy-nov-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('soy-nov-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('soy-nov-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('soy-nov-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.wheat) {
                const c = m.grains.wheat;
                document.getElementById('wheat-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('wheat-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('wheat-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('wheat-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('wheat-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('wheat-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            if (m.livestock?.cattle) {
                const c = m.livestock.cattle;
                document.getElementById('cattle-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('cattle-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('cattle-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('cattle-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('cattle-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('cattle-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.livestock?.feeder) {
                const c = m.livestock.feeder;
                document.getElementById('feeder-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('feeder-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('feeder-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('feeder-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('feeder-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('feeder-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.livestock?.hogs) {
                const c = m.livestock.hogs;
                document.getElementById('hogs-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('hogs-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('hogs-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('hogs-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('hogs-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('hogs-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.livestock?.milk) {
                const c = m.livestock.milk;
                document.getElementById('milk-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('milk-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('milk-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('milk-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('milk-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('milk-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.energy?.oil) {
                const c = m.energy.oil;
                document.getElementById('oil-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('oil-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('oil-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('oil-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('oil-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('oil-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.metals?.gold) {
                const c = m.metals.gold;
                document.getElementById('gold-price').textContent = '$' + c.price.toFixed(0);
                document.getElementById('gold-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('gold-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('gold-prev').textContent = 'prev: $' + c.prevClose.toFixed(0);
                if (c.symbol) document.getElementById('gold-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('gold-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.metals?.silver) {
                const c = m.metals.silver;
                document.getElementById('silver-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('silver-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('silver-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('silver-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('silver-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('silver-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.crypto?.bitcoin) {
                const c = m.crypto.bitcoin;
                document.getElementById('btc-price').textContent = '$' + c.price.toLocaleString(undefined, {maximumFractionDigits: 0});
                document.getElementById('btc-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('btc-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('btc-prev').textContent = 'prev: $' + c.prevClose.toLocaleString(undefined, {maximumFractionDigits: 0});
                if (c.symbol) document.getElementById('btc-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('btc-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.crypto?.kaspa) {
                const c = m.crypto.kaspa;
                document.getElementById('kas-price').textContent = '$' + c.price.toFixed(3);
                document.getElementById('kas-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('kas-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('kas-prev').textContent = 'prev: $' + c.prevClose.toFixed(3);
                if (c.symbol) document.getElementById('kas-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('kas-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.indices?.sp500) {
                const c = m.indices.sp500;
                document.getElementById('sp500-price').textContent = c.price.toLocaleString(undefined, {maximumFractionDigits: 0});
                document.getElementById('sp500-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('sp500-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('sp500-prev').textContent = 'prev: ' + c.prevClose.toLocaleString(undefined, {maximumFractionDigits: 0});
                if (c.symbol) document.getElementById('sp500-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('sp500-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (m.indices?.dollar) {
                const c = m.indices.dollar;
                document.getElementById('dxy-price').textContent = c.price.toFixed(2);
                document.getElementById('dxy-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('dxy-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('dxy-prev').textContent = 'prev: ' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('dxy-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) document.getElementById('dxy-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
            }
            
            if (data.news && data.news.length > 0) {
                const newsEl = document.getElementById('news-feed');
                newsEl.innerHTML = data.news.slice(0, 15).map(n => `
                    <div class="news-item">
                        <a href="${n.link}" target="_blank">${n.title}</a>
                        <div class="news-source">${n.source || 'Ag News'}</div>
                    </div>
                `).join('');
            }
            
            buildTicker(m, data.news || []);
            
        } catch (e) {
            console.error(e);
            document.getElementById('update-time').textContent = 'Offline';
            document.getElementById('update-time').classList.remove('loading');
        }
    }
    
    function buildTicker(m, news) {
        const items = [];
        const chgClass = (val) => val >= 0 ? 'up' : 'down';
        const chgSign = (val) => val >= 0 ? '+' : '';
        
        if (m.grains?.corn) {
            const c = m.grains.corn;
            items.push(`<span class="ticker-item"><span class="label">üåΩ Corn</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.grains?.soybeans) {
            const c = m.grains.soybeans;
            items.push(`<span class="ticker-item"><span class="label">ü´ò Beans</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.grains?.wheat) {
            const c = m.grains.wheat;
            items.push(`<span class="ticker-item"><span class="label">üåæ Wheat</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.livestock?.cattle) {
            const c = m.livestock.cattle;
            items.push(`<span class="ticker-item"><span class="label">üêÑ Cattle</span><span class="price">$${c.price.toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.crypto?.bitcoin) {
            const c = m.crypto.bitcoin;
            items.push(`<span class="ticker-item"><span class="label">‚Çø BTC</span><span class="price">$${c.price.toLocaleString(undefined,{maximumFractionDigits:0})}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.crypto?.kaspa) {
            const c = m.crypto.kaspa;
            items.push(`<span class="ticker-item"><span class="label">KAS</span><span class="price">$${c.price.toFixed(3)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (news.length > 0) {
            news.slice(0, 3).forEach(n => {
                items.push(`<span class="ticker-item news">üì∞ ${n.title}</span>`);
            });
        }
        document.getElementById('ticker').innerHTML = items.join('') + items.join('');
    }
    
    loadData();
    setInterval(loadData, 2 * 60 * 1000);
    
    async function loadForecast() {
        try {
            const res = await fetch('https://api.weather.gov/gridpoints/DLH/75,63/forecast');
            if (!res.ok) throw new Error('Forecast unavailable');
            const data = await res.json();
            const periods = data.properties.periods;
            
            const wxIcon = (forecast, isDay) => {
                const f = forecast.toLowerCase();
                if (f.includes('thunder') || f.includes('storm')) return '‚õàÔ∏è';
                if (f.includes('rain') || f.includes('shower')) return 'üåßÔ∏è';
                if (f.includes('snow') || f.includes('flurr')) return 'üå®Ô∏è';
                if (f.includes('cloud') || f.includes('overcast')) return '‚òÅÔ∏è';
                if (f.includes('partly') || f.includes('mostly sunny')) return isDay ? '‚õÖ' : 'üåô';
                if (f.includes('fog') || f.includes('mist')) return 'üå´Ô∏è';
                if (f.includes('wind')) return 'üí®';
                return isDay ? '‚òÄÔ∏è' : 'üåô';
            };
            
            if (periods[0]) {
                document.getElementById('wx-today-icon').textContent = wxIcon(periods[0].shortForecast, periods[0].isDaytime);
                document.getElementById('wx-today-temp').textContent = periods[0].temperature + '¬∞' + periods[0].temperatureUnit;
                document.getElementById('wx-today-desc').textContent = periods[0].shortForecast.substring(0, 20);
            }
            if (periods[1]) {
                document.getElementById('wx-tonight-icon').textContent = wxIcon(periods[1].shortForecast, periods[1].isDaytime);
                document.getElementById('wx-tonight-temp').textContent = periods[1].temperature + '¬∞' + periods[1].temperatureUnit;
                document.getElementById('wx-tonight-desc').textContent = periods[1].shortForecast.substring(0, 20);
            }
            if (periods[2]) {
                document.getElementById('wx-tomorrow-icon').textContent = wxIcon(periods[2].shortForecast, periods[2].isDaytime);
                document.getElementById('wx-tomorrow-temp').textContent = periods[2].temperature + '¬∞' + periods[2].temperatureUnit;
                document.getElementById('wx-tomorrow-desc').textContent = periods[2].shortForecast.substring(0, 20);
            }
            if (periods[3]) {
                document.getElementById('wx-tomnight-icon').textContent = wxIcon(periods[3].shortForecast, periods[3].isDaytime);
                document.getElementById('wx-tomnight-temp').textContent = periods[3].temperature + '¬∞' + periods[3].temperatureUnit;
                document.getElementById('wx-tomnight-desc').textContent = periods[3].shortForecast.substring(0, 20);
            }
        } catch (e) {
            console.log('Forecast error:', e);
        }
    }
    
    loadForecast();
    setInterval(loadForecast, 30 * 60 * 1000);
    
    function getGreeting() {
        const hour = new Date().getHours();
        if (hour < 5) return 'üåô Late night';
        if (hour < 12) return '‚òÄÔ∏è Good morning';
        if (hour < 17) return 'üå§Ô∏è Good afternoon';
        if (hour < 21) return 'üåÖ Good evening';
        return 'üåô Good night';
    }
    
    function setWelcome(location) {
        const greeting = getGreeting();
        const msg = location ? `${greeting} from ${location}` : greeting;
        document.getElementById('welcome-msg').textContent = msg;
    }
    
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                fetch(`https://nominatim.openstreetmap.org/reverse?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&format=json`)
                    .then(r => r.json())
                    .then(data => {
                        const county = data.address?.county || data.address?.city || data.address?.state || '';
                        if (county) setWelcome(county);
                    })
                    .catch(() => setWelcome(''));
            },
            () => setWelcome(''),
            { timeout: 5000, maximumAge: 600000 }
        );
    } else {
        setWelcome('');
    }
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW error:', err));
    }
    </script>
</body>
</html>
