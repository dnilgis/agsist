<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KXCTD5Z9H"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-6KXCTD5Z9H');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGSIST - Free Agricultural Dashboard & Prices</title>
    <meta name="description" content="Free live agricultural commodity prices, weather radar, and farm tools. Corn, soybean, wheat futures updated every 15 minutes. Built for farmers.">
    <meta name="keywords" content="corn prices today, soybean prices, wheat futures, ag commodity prices, farm dashboard, grain prices, livestock prices">
    <link rel="canonical" href="https://agsist.com/">
    
    <!-- Schema.org for Organization -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "AGSIST",
        "description": "Free agricultural dashboard with live commodity prices, farm calculators, and tools for farmers",
        "url": "https://agsist.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://agsist.com/tools.html",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "AGSIST",
        "url": "https://agsist.com",
        "logo": "https://agsist.com/icon-512.png",
        "description": "Agricultural technology tools built by farmers for farmers"
    }
    </script>
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#e6b042">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AGSIST">
    
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta property="og:title" content="AGSIST | Free Live Ag Dashboard">
    <meta property="og:description" content="Free live commodity prices, weather radar, and farm tools. Built for farmers.">
    <meta property="og:image" content="https://agsist.com/og-image.png">
    <meta property="og:url" content="https://agsist.com/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Shared Styles (nav, footer, variables) -->
    <link rel="stylesheet" href="/components/shared.css">
    
    <style>
        /* ============================================
           TICKER
           ============================================ */
        .ticker-wrap {
            background: #000;
            border-bottom: 1px solid var(--border);
            overflow: hidden;
            padding: 10px 0;
        }
        
        .ticker {
            display: flex;
            gap: 50px;
            animation: ticker-scroll 120s linear infinite;
            white-space: nowrap;
            width: max-content;
            padding: 0 20px;
        }
        
        .ticker:hover { animation-play-state: paused; }
        
        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        
        .ticker-item .label { color: var(--dim); font-weight: 500; }
        .ticker-item .price { color: var(--text); font-weight: 700; }
        .ticker-item .change { font-size: 0.9rem; font-weight: 600; }
        .ticker-item .change.up { color: var(--green); }
        .ticker-item .change.down { color: var(--red); }
        .ticker-item.news { color: var(--accent); max-width: 500px; overflow: hidden; text-overflow: ellipsis; }
        
        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* ============================================
           MORNING BRIEFING
           ============================================ */
        .morning-briefing {
            background: linear-gradient(135deg, #1a1500 0%, var(--card) 50%, #0a0a1a 100%);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 16px 18px;
            margin-bottom: 14px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 14px;
            align-items: start;
        }
        .briefing-section { min-width: 0; }
        .briefing-label { font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .briefing-prices { display: flex; flex-direction: column; gap: 4px; }
        .bp-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; }
        .bp-name { color: var(--dim); }
        .bp-price { color: var(--text); font-weight: 600; }
        .bp-chg { font-size: 0.8rem; font-weight: 600; margin-left: 6px; }
        .bp-chg.up { color: var(--green); }
        .bp-chg.down { color: var(--red); }
        .briefing-wx { font-size: 0.9rem; color: var(--text); line-height: 1.6; }
        .briefing-wx .wx-temp { font-size: 1.3rem; font-weight: 700; }
        .briefing-reports { display: flex; flex-direction: column; gap: 4px; }
        .br-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; }
        .br-name { color: var(--text); font-weight: 600; }
        .br-date { color: var(--dim); }
        .br-impact { font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 8px; }
        .br-impact.high { background: rgba(239,68,68,0.15); color: #ef4444; }
        .br-impact.medium { background: rgba(245,158,11,0.15); color: #f59e0b; }
        .briefing-link { font-size: 0.75rem; color: var(--accent); text-decoration: none; margin-top: 4px; display: inline-block; }
        .briefing-link:hover { text-decoration: underline; }

        /* ============================================
           MAIN CONTENT
           ============================================ */
        main { max-width: 1600px; margin: 0 auto; padding: 12px; }
        .update-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; color: var(--dim); }
        
        /* ============================================
           PRICE CARDS
           ============================================ */
        .price-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px; }
        
        a.card-link { text-decoration: none; color: inherit; display: block; }
        a.card-link:hover .price-card, a.card-link:focus .price-card,
        a.card-link:hover .secondary-card, a.card-link:focus .secondary-card {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230,176,66,0.15);
        }
        
        .price-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .price-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230,176,66,0.15);
        }
        
        .price-card.featured {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--card) 0%, #1a1500 100%);
        }
        
        .price-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .price-label { font-size: 0.95rem; color: var(--text); font-weight: 600; }
        .price-contract { font-size: 0.9rem; color: var(--dim); background: var(--bg); padding: 3px 8px; border-radius: 4px; }
        .price-value { font-size: 2rem; font-weight: 700; margin-bottom: 4px; }
        .price-change { font-size: 0.95rem; font-weight: 600; }
        .price-change.up { color: var(--green); }
        .price-change.down { color: var(--red); }
        .price-meta { display: flex; gap: 12px; font-size: 0.875rem; color: var(--dim); margin-top: 4px; }
        .price-meta span { white-space: nowrap; }
        
        .range-bar { margin: 8px 0 4px; }
        .range-bar-label { display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--dim); margin-bottom: 4px; }
        .range-bar-track { height: 6px; background: var(--border); border-radius: 3px; position: relative; }
        .range-bar-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #4ade80, #e6b042, #ef4444); border-radius: 3px; opacity: 0.3; }
        .range-bar-marker { position: absolute; top: -2px; width: 10px; height: 10px; background: var(--accent); border-radius: 50%; transform: translateX(-50%); border: 2px solid var(--card); }
        
        .section-header { font-size: 0.9rem; color: var(--dim); text-transform: uppercase; letter-spacing: 0.05em; margin: 16px 0 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
        
        /* ============================================
           SECONDARY CARDS
           ============================================ */
        .secondary-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 12px; }
        .secondary-card { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 12px; cursor: pointer; transition: all 0.2s; position: relative; }
        .secondary-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(230,176,66,0.15); }
        .secondary-label { font-size: 0.9rem; color: var(--dim); margin-bottom: 6px; }
        .secondary-value { font-size: 1.25rem; font-weight: 700; }
        .secondary-change { font-size: 0.9rem; font-weight: 600; }
        .secondary-meta { display: flex; gap: 8px; font-size: 0.875rem; color: var(--dim); margin-top: 4px; }
        
        .range-bar-sm { margin-top: 6px; }
        .range-bar-sm .range-bar-label { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--dim); margin-bottom: 2px; }
        .range-bar-sm .range-bar-track { height: 4px; background: var(--border); border-radius: 2px; position: relative; }
        .range-bar-sm .range-bar-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #4ade80, #e6b042, #ef4444); border-radius: 2px; opacity: 0.3; }
        .range-bar-sm .range-bar-marker { position: absolute; top: -2px; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; transform: translateX(-50%); border: 1px solid var(--card); }
        
        /* ============================================
           WEATHER & NEWS
           ============================================ */
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        .forecast-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }
        .forecast-card .fc-label { color: var(--dim); font-size: 0.8rem; }
        .forecast-card .fc-icon { font-size: 1.5rem; margin: 4px 0; }
        .forecast-card .fc-temp { font-weight: 600; }
        .forecast-card .fc-desc { font-size: 0.8rem; color: var(--dim); }
        
        .weather-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .weather-card iframe { width: 100%; height: 420px; border: none; display: block; }
        
        .news-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; }
        .news-card::-webkit-scrollbar { display: none; }
        .news-item { padding: 10px 0; border-bottom: 1px solid var(--border); }
        .news-item:last-child { border-bottom: none; padding-bottom: 0; }
        .news-item:first-child { padding-top: 0; }
        .news-item a { color: var(--text); text-decoration: none; font-size: 0.95rem; line-height: 1.6; display: block; }
        .news-item a:hover { color: var(--accent); }
        .news-source { font-size: 0.875rem; color: var(--dim); margin-top: 4px; display: flex; justify-content: space-between; align-items: center; }
        .news-summary-btn { background: none; border: 1px solid var(--border); color: var(--dim); font-size: 0.75rem; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-weight: 600; font-family: inherit; }
        .news-summary-btn:hover { color: var(--accent); border-color: var(--accent); }
        
        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--card); border: 1px solid var(--border); border-radius: 12px; max-width: 600px; width: 100%; max-height: 85vh; overflow-y: auto; animation: modalSlide 0.2s ease-out; }
        @keyframes modalSlide { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; }
        .modal-header h3 { font-size: 0.75rem; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin: 0 0 6px 0; display: flex; align-items: center; gap: 8px; }
        .modal-header .sub-note { font-size: 0.75rem; color: var(--dim); font-weight: 400; }
        .modal-close { background: none; border: none; color: var(--dim); font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; }
        .modal-close:hover { color: var(--text); }
        .modal-body { padding: 20px; }
        .modal-source { display: inline-flex; align-items: center; gap: 8px; background: var(--bg); padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; color: var(--dim); margin-bottom: 16px; }
        .modal-title { font-size: 1.1rem; font-weight: 600; color: var(--text); margin-bottom: 16px; line-height: 1.4; }
        .modal-summary { color: var(--text); font-size: 0.9rem; line-height: 1.8; white-space: pre-wrap; }
        .modal-footer { padding: 16px 20px; border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end; }
        .modal-btn { padding: 10px 20px; border-radius: 6px; font-family: inherit; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .modal-btn-secondary { background: var(--bg); border: 1px solid var(--border); color: var(--dim); }
        .modal-btn-secondary:hover { border-color: var(--text); color: var(--text); }
        .modal-btn-primary { background: var(--accent); border: 1px solid var(--accent); color: #000; }
        .modal-btn-primary:hover { opacity: 0.9; }
        
        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (min-width: 768px) {
            main { padding: 16px 20px; }
            .price-grid { grid-template-columns: repeat(4, 1fr); }
            .secondary-grid { grid-template-columns: repeat(3, 1fr); }
            .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: stretch; }
            .two-col > div { display: flex; flex-direction: column; }
            .two-col .news-card { flex: 1; }
            .weather-card iframe { height: 380px; }
        }
        
        @media (min-width: 1200px) {
            main { padding: 16px 24px; }
            .secondary-grid { grid-template-columns: repeat(6, 1fr); }
            .weather-card iframe { height: 400px; }
        }
        
        @media (max-width: 767px) {
            /* Morning briefing: stack to 1 column */
            .morning-briefing { grid-template-columns: 1fr; gap: 12px; padding: 14px; }
            
            /* Price cards: 2-up, equal height */
            .price-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .price-card {
                padding: 10px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
            .card-link { display: flex; }
            .card-link .price-card { width: 100%; }
            .price-header { flex-wrap: wrap; gap: 4px; margin-bottom: 6px; }
            .price-label { font-size: 0.8rem; }
            .price-contract { font-size: 0.7rem; padding: 2px 6px; }
            .price-value { font-size: 1.3rem; margin-bottom: 2px; }
            .price-change { font-size: 0.8rem; }
            .price-meta { font-size: 0.7rem; gap: 6px; flex-wrap: wrap; }
            .price-meta span { white-space: normal; }
            .range-bar { margin: 6px 0 2px; }
            .range-bar-label { font-size: 0.7rem; }
            
            /* Secondary cards: 2-up */
            .secondary-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .secondary-card { padding: 10px; overflow: hidden; }
            .secondary-label { font-size: 0.75rem; margin-bottom: 4px; }
            .secondary-value { font-size: 1.05rem; }
            .secondary-change { font-size: 0.75rem; }
            .secondary-meta { font-size: 0.7rem; }
            .range-bar-sm .range-bar-label { font-size: 0.7rem; }
            
            /* Forecast: 2x2 grid */
            .forecast-grid { grid-template-columns: repeat(2, 1fr); }
            
            /* Weather/News: stack */
            .two-col { display: block; }
            .two-col > div { margin-bottom: 16px; }
            .weather-card iframe { height: 300px; }
            
            /* Ticker smaller */
            .ticker-item { font-size: 0.8rem; }
            .ticker { gap: 30px; }
        }
        
        @media (max-width: 374px) {
            .price-grid { grid-template-columns: 1fr; }
            .price-value { font-size: 1.5rem; }
            .secondary-grid { grid-template-columns: 1fr 1fr; }
            .forecast-grid { grid-template-columns: 1fr 1fr; }
        }
        
        /* ============================================
           UTILITIES
           ============================================ */
        input[type="text"], input[type="number"], input[type="email"], select, textarea { font-size: 16px !important; }
        a:focus, button:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
        html, body { overflow-x: hidden; }
        .loading { color: var(--dim); font-style: italic; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    </style>
</head>
<body>
    <!-- Header (loaded from /components/header.html) -->
    <div id="header"></div>
    
    <div class="ticker-wrap">
        <div class="ticker" id="ticker"></div>
    </div>
    
    <main>
        <h1 class="sr-only">AGSIST - Free Live Agricultural Commodity Prices, News & Weather Dashboard</h1>
        <div id="welcome-msg" style="margin-bottom:12px;font-size:0.95rem;color:var(--text)"></div>
        
        <!-- Morning Briefing -->
        <div class="morning-briefing" id="morning-briefing">
            <div class="briefing-section">
                <div class="briefing-label">üìã Morning Briefing</div>
                <div class="briefing-prices" id="briefing-prices">
                    <div class="bp-row"><span class="bp-name">üåΩ Corn</span><span><span class="bp-price" id="bp-corn">--</span><span class="bp-chg" id="bp-corn-chg"></span></span></div>
                    <div class="bp-row"><span class="bp-name">ü´ò Beans</span><span><span class="bp-price" id="bp-soy">--</span><span class="bp-chg" id="bp-soy-chg"></span></span></div>
                    <div class="bp-row"><span class="bp-name">üåæ Wheat</span><span><span class="bp-price" id="bp-wheat">--</span><span class="bp-chg" id="bp-wheat-chg"></span></span></div>
                </div>
                <a href="/ag-odds.html" class="briefing-link">üéØ Ag Odds & Outlook ‚Üí</a>
            </div>
            <div class="briefing-section">
                <div class="briefing-label">üå§Ô∏è Local Weather</div>
                <div class="briefing-wx" id="briefing-wx">
                    <span class="wx-temp" id="bwx-temp">--</span>
                    <span id="bwx-desc">Loading...</span>
                    <div style="font-size:0.8rem;color:var(--dim);margin-top:4px" id="bwx-wind"></div>
                </div>
            </div>
            <div class="briefing-section">
                <div class="briefing-label">üìÖ Reporting This Week</div>
                <div class="briefing-reports" id="briefing-reports">
                    <div style="color:var(--dim);font-size:0.8rem">Loading...</div>
                </div>
                <a href="/calendar.html" class="briefing-link">Full Calendar ‚Üí</a>
            </div>
        </div>
        
        <div class="update-bar">
            <span>Last updated: <span id="update-time" class="loading">Loading...</span></span>
            <span>Data auto-refreshes</span>
        </div>
        
        <div class="price-grid" id="primary-prices">
            <a href="corn-prices.html" class="card-link">
                <div class="price-card featured" id="card-corn">
                    <div class="price-header">
                        <span class="price-label">üåΩ Corn</span>
                        <span class="price-contract" id="corn-contract">--</span>
                    </div>
                    <div class="price-value" id="corn-price">--</div>
                    <div class="price-change" id="corn-change">--</div>
                    <div class="price-meta"><span id="corn-prev">--</span><span id="corn-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="corn-range-low">--</span><span>52wk</span><span id="corn-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="corn-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <a href="corn-prices.html" class="card-link">
                <div class="price-card" id="card-corn-dec">
                    <div class="price-header">
                        <span class="price-label">üåΩ Corn Harvest</span>
                        <span class="price-contract">Dec '26</span>
                    </div>
                    <div class="price-value" id="corn-dec-price">--</div>
                    <div class="price-change" id="corn-dec-change">--</div>
                    <div class="price-meta"><span id="corn-dec-prev">--</span><span id="corn-dec-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="corn-dec-range-low">--</span><span>52wk</span><span id="corn-dec-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="corn-dec-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <a href="soybean-prices.html" class="card-link">
                <div class="price-card featured" id="card-soy">
                    <div class="price-header">
                        <span class="price-label">ü´ò Soybeans</span>
                        <span class="price-contract" id="soy-contract">--</span>
                    </div>
                    <div class="price-value" id="soy-price">--</div>
                    <div class="price-change" id="soy-change">--</div>
                    <div class="price-meta"><span id="soy-prev">--</span><span id="soy-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="soy-range-low">--</span><span>52wk</span><span id="soy-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="soy-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <a href="soybean-prices.html" class="card-link">
                <div class="price-card" id="card-soy-nov">
                    <div class="price-header">
                        <span class="price-label">ü´ò Beans Harvest</span>
                        <span class="price-contract">Nov '26</span>
                    </div>
                    <div class="price-value" id="soy-nov-price">--</div>
                    <div class="price-change" id="soy-nov-change">--</div>
                    <div class="price-meta"><span id="soy-nov-prev">--</span><span id="soy-nov-symbol">--</span></div>
                    <div class="range-bar">
                        <div class="range-bar-label"><span id="soy-nov-range-low">--</span><span>52wk</span><span id="soy-nov-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="soy-nov-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
        </div>
        <div class="section-header">Livestock & Energy</div>
        <div class="secondary-grid" id="secondary-prices">
            <a href="wheat-prices.html" class="card-link">
                <div class="secondary-card">
                    <div class="secondary-label">üåæ Wheat</div>
                    <div class="secondary-value" id="wheat-price">--</div>
                    <div class="secondary-change" id="wheat-change">--</div>
                    <div class="secondary-meta"><span id="wheat-prev">--</span><span id="wheat-symbol">--</span></div>
                    <div class="range-bar-sm">
                        <div class="range-bar-label"><span id="wheat-range-low">--</span><span>52wk</span><span id="wheat-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="wheat-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <div class="secondary-card">
                <div class="secondary-label">üêÑ Live Cattle</div>
                <div class="secondary-value" id="cattle-price">--</div>
                <div class="secondary-change" id="cattle-change">--</div>
                <div class="secondary-meta"><span id="cattle-prev">--</span><span id="cattle-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="cattle-range-low">--</span><span>52wk</span><span id="cattle-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="cattle-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üêÇ Feeder Cattle</div>
                <div class="secondary-value" id="feeder-price">--</div>
                <div class="secondary-change" id="feeder-change">--</div>
                <div class="secondary-meta"><span id="feeder-prev">--</span><span id="feeder-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="feeder-range-low">--</span><span>52wk</span><span id="feeder-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="feeder-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üê∑ Lean Hogs</div>
                <div class="secondary-value" id="hogs-price">--</div>
                <div class="secondary-change" id="hogs-change">--</div>
                <div class="secondary-meta"><span id="hogs-prev">--</span><span id="hogs-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="hogs-range-low">--</span><span>52wk</span><span id="hogs-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="hogs-marker" style="left:50%"></div></div>
                </div>
            </div>
            <a href="milk-prices.html" class="card-link">
                <div class="secondary-card">
                    <div class="secondary-label">ü•õ Class III Milk</div>
                    <div class="secondary-value" id="milk-price">--</div>
                    <div class="secondary-change" id="milk-change">--</div>
                    <div class="secondary-meta"><span id="milk-prev">--</span><span id="milk-symbol">--</span></div>
                    <div class="range-bar-sm">
                        <div class="range-bar-label"><span id="milk-range-low">--</span><span>52wk</span><span id="milk-range-high">--</span></div>
                        <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="milk-marker" style="left:50%"></div></div>
                    </div>
                </div>
            </a>
            <div class="secondary-card">
                <div class="secondary-label">üõ¢Ô∏è Crude Oil</div>
                <div class="secondary-value" id="oil-price">--</div>
                <div class="secondary-change" id="oil-change">--</div>
                <div class="secondary-meta"><span id="oil-prev">--</span><span id="oil-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="oil-range-low">--</span><span>52wk</span><span id="oil-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="oil-marker" style="left:50%"></div></div>
                </div>
            </div>
        </div>
        
        <div class="section-header">Metals & Crypto</div>
        <div class="secondary-grid">
            <div class="secondary-card">
                <div class="secondary-label">ü•á Gold</div>
                <div class="secondary-value" id="gold-price">--</div>
                <div class="secondary-change" id="gold-change">--</div>
                <div class="secondary-meta"><span id="gold-prev">--</span><span id="gold-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="gold-range-low">--</span><span>52wk</span><span id="gold-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="gold-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">ü•à Silver</div>
                <div class="secondary-value" id="silver-price">--</div>
                <div class="secondary-change" id="silver-change">--</div>
                <div class="secondary-meta"><span id="silver-prev">--</span><span id="silver-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="silver-range-low">--</span><span>52wk</span><span id="silver-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="silver-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">ü™ô Bitcoin</div>
                <div class="secondary-value" id="btc-price">--</div>
                <div class="secondary-change" id="btc-change">--</div>
                <div class="secondary-meta"><span id="btc-prev">--</span><span id="btc-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="btc-range-low">--</span><span>52wk</span><span id="btc-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="btc-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üíé Kaspa</div>
                <div class="secondary-value" id="kas-price">--</div>
                <div class="secondary-change" id="kas-change">--</div>
                <div class="secondary-meta"><span id="kas-prev">--</span><span id="kas-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="kas-range-low">--</span><span>52wk</span><span id="kas-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="kas-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üìà S&P 500</div>
                <div class="secondary-value" id="sp500-price">--</div>
                <div class="secondary-change" id="sp500-change">--</div>
                <div class="secondary-meta"><span id="sp500-prev">--</span><span id="sp500-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="sp500-range-low">--</span><span>52wk</span><span id="sp500-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="sp500-marker" style="left:50%"></div></div>
                </div>
            </div>
            <div class="secondary-card">
                <div class="secondary-label">üíµ USD Index</div>
                <div class="secondary-value" id="dxy-price">--</div>
                <div class="secondary-change" id="dxy-change">--</div>
                <div class="secondary-meta"><span id="dxy-prev">--</span><span id="dxy-symbol">--</span></div>
                <div class="range-bar-sm">
                    <div class="range-bar-label"><span id="dxy-range-low">--</span><span>52wk</span><span id="dxy-range-high">--</span></div>
                    <div class="range-bar-track"><div class="range-bar-fill" style="width:100%"></div><div class="range-bar-marker" id="dxy-marker" style="left:50%"></div></div>
                </div>
            </div>
        </div>
        <div class="two-col">
            <div>
                <div class="section-header" style="display:flex;justify-content:space-between;align-items:center">
                    <span>üì∞ Ag News</span>
                    <a href="/news.html" style="font-size:0.75rem;color:var(--accent);text-decoration:none;text-transform:none;letter-spacing:0">View All ‚Üí</a>
                </div>
                <div class="news-card" id="news-feed">
                    <div class="news-item loading">Loading news...</div>
                </div>
            </div>
            <div>
                <div class="section-header">üå§Ô∏è Weather</div>
                <div id="forecast" class="forecast-grid">
                    <div class="forecast-card">
                        <div class="fc-label">TODAY</div>
                        <div class="fc-icon" id="wx-today-icon">--</div>
                        <div class="fc-temp" id="wx-today-temp">--</div>
                        <div class="fc-desc" id="wx-today-desc">--</div>
                    </div>
                    <div class="forecast-card">
                        <div class="fc-label">TONIGHT</div>
                        <div class="fc-icon" id="wx-tonight-icon">--</div>
                        <div class="fc-temp" id="wx-tonight-temp">--</div>
                        <div class="fc-desc" id="wx-tonight-desc">--</div>
                    </div>
                    <div class="forecast-card">
                        <div class="fc-label">TOMORROW</div>
                        <div class="fc-icon" id="wx-tomorrow-icon">--</div>
                        <div class="fc-temp" id="wx-tomorrow-temp">--</div>
                        <div class="fc-desc" id="wx-tomorrow-desc">--</div>
                    </div>
                    <div class="forecast-card">
                        <div class="fc-label">TOM NIGHT</div>
                        <div class="fc-icon" id="wx-tomnight-icon">--</div>
                        <div class="fc-temp" id="wx-tomnight-temp">--</div>
                        <div class="fc-desc" id="wx-tomnight-desc">--</div>
                    </div>
                </div>
                <div class="weather-card">
                    <iframe src="https://embed.windy.com/embed2.html?lat=45.4&lon=-91.85&detailLat=45.4&detailLon=-91.85&width=650&height=350&zoom=7&level=surface&overlay=rain&product=ecmwf&menu=&message=true&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1" frameborder="0" title="Windy Weather"></iframe>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Summary Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal-content" id="modal-content"></div>
    </div>
    
    <!-- Footer (loaded from /components/footer.html) -->
    <div id="footer"></div>
    
    <!-- Load Components (header + footer) -->
    <script src="/components/load-components.js"></script>
    
    <script>
    async function loadData() {
        try {
            const res = await fetch('data/markets.json');
            if (!res.ok) throw new Error('Failed to load');
            const data = await res.json();
            
            document.getElementById('update-time').textContent = 
                new Date(data.updated).toLocaleString([], {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});
            document.getElementById('update-time').classList.remove('loading');
            
            const m = data.markets;
            
            const fmt = (val, unit) => {
                if (unit === '¬¢/bu') return (val / 100).toFixed(2);
                if (unit === '¬¢/lb') return val.toFixed(2);
                if (unit === '$/cwt') return val.toFixed(2);
                if (unit === '$/bbl') return val.toFixed(2);
                return val.toFixed(2);
            };
            
            const chgClass = (val) => val >= 0 ? 'up' : 'down';
            const chgSign = (val) => val >= 0 ? '+' : '';
            const rangePos = (price, low, high) => {
                if (!low || !high || high === low) return 50;
                return Math.min(100, Math.max(0, ((price - low) / (high - low)) * 100));
            };
            
            if (m.grains?.corn) {
                const c = m.grains.corn;
                document.getElementById('corn-contract').textContent = c.contract || 'Front';
                document.getElementById('corn-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('corn-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('corn-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('corn-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('corn-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('corn-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('corn-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('corn-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.corn_dec) {
                const c = m.grains.corn_dec;
                document.getElementById('corn-dec-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('corn-dec-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('corn-dec-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('corn-dec-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('corn-dec-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('corn-dec-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('corn-dec-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('corn-dec-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.soybeans) {
                const c = m.grains.soybeans;
                document.getElementById('soy-contract').textContent = c.contract || 'Front';
                document.getElementById('soy-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('soy-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('soy-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('soy-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('soy-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('soy-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('soy-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('soy-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.soybeans_nov) {
                const c = m.grains.soybeans_nov;
                document.getElementById('soy-nov-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('soy-nov-change').textContent = chgSign(c.change) + (c.change/100).toFixed(2) + ' (' + chgSign(c.changePct) + c.changePct.toFixed(1) + '%)';
                document.getElementById('soy-nov-change').className = 'price-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('soy-nov-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('soy-nov-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('soy-nov-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('soy-nov-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('soy-nov-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.grains?.wheat) {
                const c = m.grains.wheat;
                document.getElementById('wheat-price').textContent = '$' + fmt(c.price, c.unit);
                document.getElementById('wheat-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('wheat-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('wheat-prev').textContent = 'prev: $' + fmt(c.prevClose, c.unit);
                if (c.symbol) document.getElementById('wheat-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('wheat-range-low').textContent = '$' + fmt(c.low52, c.unit);
                    document.getElementById('wheat-range-high').textContent = '$' + fmt(c.high52, c.unit);
                    document.getElementById('wheat-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            // ---- Morning Briefing Prices ----
            if (m.grains?.corn) {
                var bc = m.grains.corn;
                document.getElementById('bp-corn').textContent = '$' + fmt(bc.price, bc.unit);
                var bce = document.getElementById('bp-corn-chg');
                bce.textContent = (bc.change >= 0 ? '‚ñ≤' : '‚ñº') + Math.abs(bc.change/100).toFixed(2);
                bce.className = 'bp-chg ' + (bc.change >= 0 ? 'up' : 'down');
            }
            if (m.grains?.soybeans) {
                var bs = m.grains.soybeans;
                document.getElementById('bp-soy').textContent = '$' + fmt(bs.price, bs.unit);
                var bse = document.getElementById('bp-soy-chg');
                bse.textContent = (bs.change >= 0 ? '‚ñ≤' : '‚ñº') + Math.abs(bs.change/100).toFixed(2);
                bse.className = 'bp-chg ' + (bs.change >= 0 ? 'up' : 'down');
            }
            if (m.grains?.wheat) {
                var bw = m.grains.wheat;
                document.getElementById('bp-wheat').textContent = '$' + fmt(bw.price, bw.unit);
                var bwe = document.getElementById('bp-wheat-chg');
                bwe.textContent = (bw.change >= 0 ? '‚ñ≤' : '‚ñº') + Math.abs(bw.change/100).toFixed(2);
                bwe.className = 'bp-chg ' + (bw.change >= 0 ? 'up' : 'down');
            }
            
            if (m.livestock?.cattle) {
                const c = m.livestock.cattle;
                document.getElementById('cattle-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('cattle-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('cattle-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('cattle-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('cattle-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('cattle-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('cattle-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('cattle-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.livestock?.feeder) {
                const c = m.livestock.feeder;
                document.getElementById('feeder-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('feeder-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('feeder-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('feeder-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('feeder-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('feeder-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('feeder-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('feeder-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.livestock?.hogs) {
                const c = m.livestock.hogs;
                document.getElementById('hogs-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('hogs-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('hogs-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('hogs-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('hogs-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('hogs-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('hogs-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('hogs-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.livestock?.milk) {
                const c = m.livestock.milk;
                document.getElementById('milk-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('milk-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('milk-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('milk-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('milk-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('milk-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('milk-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('milk-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.energy?.oil) {
                const c = m.energy.oil;
                document.getElementById('oil-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('oil-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('oil-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('oil-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('oil-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('oil-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('oil-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('oil-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.metals?.gold) {
                const c = m.metals.gold;
                document.getElementById('gold-price').textContent = '$' + c.price.toFixed(0);
                document.getElementById('gold-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('gold-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('gold-prev').textContent = 'prev: $' + c.prevClose.toFixed(0);
                if (c.symbol) document.getElementById('gold-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('gold-range-low').textContent = '$' + c.low52.toFixed(0);
                    document.getElementById('gold-range-high').textContent = '$' + c.high52.toFixed(0);
                    document.getElementById('gold-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.metals?.silver) {
                const c = m.metals.silver;
                document.getElementById('silver-price').textContent = '$' + c.price.toFixed(2);
                document.getElementById('silver-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('silver-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('silver-prev').textContent = 'prev: $' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('silver-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('silver-range-low').textContent = '$' + c.low52.toFixed(2);
                    document.getElementById('silver-range-high').textContent = '$' + c.high52.toFixed(2);
                    document.getElementById('silver-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.crypto?.bitcoin) {
                const c = m.crypto.bitcoin;
                document.getElementById('btc-price').textContent = '$' + c.price.toLocaleString(undefined, {maximumFractionDigits: 0});
                document.getElementById('btc-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('btc-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('btc-prev').textContent = 'prev: $' + c.prevClose.toLocaleString(undefined, {maximumFractionDigits: 0});
                if (c.symbol) document.getElementById('btc-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('btc-range-low').textContent = '$' + c.low52.toLocaleString(undefined, {maximumFractionDigits: 0});
                    document.getElementById('btc-range-high').textContent = '$' + c.high52.toLocaleString(undefined, {maximumFractionDigits: 0});
                    document.getElementById('btc-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.crypto?.kaspa) {
                const c = m.crypto.kaspa;
                document.getElementById('kas-price').textContent = '$' + c.price.toFixed(3);
                document.getElementById('kas-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('kas-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('kas-prev').textContent = 'prev: $' + c.prevClose.toFixed(3);
                if (c.symbol) document.getElementById('kas-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('kas-range-low').textContent = '$' + c.low52.toFixed(3);
                    document.getElementById('kas-range-high').textContent = '$' + c.high52.toFixed(3);
                    document.getElementById('kas-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.indices?.sp500) {
                const c = m.indices.sp500;
                document.getElementById('sp500-price').textContent = c.price.toLocaleString(undefined, {maximumFractionDigits: 0});
                document.getElementById('sp500-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('sp500-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('sp500-prev').textContent = 'prev: ' + c.prevClose.toLocaleString(undefined, {maximumFractionDigits: 0});
                if (c.symbol) document.getElementById('sp500-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('sp500-range-low').textContent = c.low52.toLocaleString(undefined, {maximumFractionDigits: 0});
                    document.getElementById('sp500-range-high').textContent = c.high52.toLocaleString(undefined, {maximumFractionDigits: 0});
                    document.getElementById('sp500-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (m.indices?.dollar) {
                const c = m.indices.dollar;
                document.getElementById('dxy-price').textContent = c.price.toFixed(2);
                document.getElementById('dxy-change').textContent = chgSign(c.changePct) + c.changePct.toFixed(1) + '%';
                document.getElementById('dxy-change').className = 'secondary-change ' + chgClass(c.change);
                if (c.prevClose) document.getElementById('dxy-prev').textContent = 'prev: ' + c.prevClose.toFixed(2);
                if (c.symbol) document.getElementById('dxy-symbol').textContent = c.symbol;
                if (c.low52 && c.high52) {
                    document.getElementById('dxy-range-low').textContent = c.low52.toFixed(2);
                    document.getElementById('dxy-range-high').textContent = c.high52.toFixed(2);
                    document.getElementById('dxy-marker').style.left = rangePos(c.price, c.low52, c.high52) + '%';
                }
            }
            
            if (data.news && data.news.length > 0) {
                const newsEl = document.getElementById('news-feed');
                newsEl.innerHTML = data.news.slice(0, 15).map((n, i) => `
                    <div class="news-item">
                        <a href="${n.link}" target="_blank">${n.title}</a>
                        <div class="news-source">
                            <span>${n.source || 'Ag News'}</span>
                            <button class="news-summary-btn" onclick="showSummary(${i}, 'markets')">Summary</button>
                        </div>
                    </div>
                `).join('');
                window.marketsNews = data.news;
            }
            
            // Fetch richer news from news.json for ticker
            fetchNewsForTicker(m);
            
        } catch (e) {
            console.error(e);
            document.getElementById('update-time').textContent = 'Offline';
            document.getElementById('update-time').classList.remove('loading');
        }
    }
    
    function buildTicker(m, news) {
        const items = [];
        const chgClass = (val) => val >= 0 ? 'up' : 'down';
        const chgSign = (val) => val >= 0 ? '+' : '';
        
        if (m.grains?.corn) {
            const c = m.grains.corn;
            items.push(`<span class="ticker-item"><span class="label">üåΩ Corn</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.grains?.soybeans) {
            const c = m.grains.soybeans;
            items.push(`<span class="ticker-item"><span class="label">ü´ò Beans</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.grains?.wheat) {
            const c = m.grains.wheat;
            items.push(`<span class="ticker-item"><span class="label">üåæ Wheat</span><span class="price">$${(c.price/100).toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.livestock?.cattle) {
            const c = m.livestock.cattle;
            items.push(`<span class="ticker-item"><span class="label">üêÑ Cattle</span><span class="price">$${c.price.toFixed(2)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.crypto?.bitcoin) {
            const c = m.crypto.bitcoin;
            items.push(`<span class="ticker-item"><span class="label">‚Çø BTC</span><span class="price">$${c.price.toLocaleString(undefined,{maximumFractionDigits:0})}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (m.crypto?.kaspa) {
            const c = m.crypto.kaspa;
            items.push(`<span class="ticker-item"><span class="label">KAS</span><span class="price">$${c.price.toFixed(3)}</span><span class="change ${chgClass(c.change)}">${chgSign(c.changePct)}${c.changePct.toFixed(1)}%</span></span>`);
        }
        if (news.length > 0) {
            news.slice(0, 5).forEach(n => {
                const title = n.title.length > 80 ? n.title.substring(0, 77) + '...' : n.title;
                items.push(`<span class="ticker-item news">üì∞ ${title}</span>`);
            });
        }
        document.getElementById('ticker').innerHTML = items.join('') + items.join('');
    }
    
    // Fetch richer news from news.json for ticker
    async function fetchNewsForTicker(markets) {
        try {
            const res = await fetch('data/news.json?t=' + Date.now());
            if (res.ok) {
                const data = await res.json();
                if (data.items && data.items.length > 0) {
                    window.newsHubItems = data.items;
                    buildTicker(markets, data.items);
                }
            }
        } catch (e) {
            // Fallback to markets news if news.json fails
            buildTicker(markets, window.marketsNews || []);
        }
    }
    
    // Modal functions
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    
    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }
    
    function timeAgo(timestamp) {
        if (!timestamp) return '';
        const now = Date.now();
        const diff = Math.floor((now - timestamp) / 1000);
        if (diff < 60) return 'just now';
        if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
        if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
        if (diff < 604800) return Math.floor(diff / 86400) + 'd ago';
        return new Date(timestamp).toLocaleDateString();
    }
    
    function showSummary(index, source) {
        let article;
        if (source === 'markets') {
            article = window.marketsNews?.[index];
        } else {
            article = window.newsHubItems?.[index];
        }
        if (!article) return;
        
        const summary = article.summary || article.description || 'No summary available. Click "Read Full Article" to view the original.';
        const isAI = article.summary && article.summary.length > 100;
        const time = article.timestamp ? timeAgo(article.timestamp) : (article.pubDate ? new Date(article.pubDate).toLocaleDateString() : '');
        
        modalContent.innerHTML = 
            '<div class="modal-header">' +
                '<div>' +
                    '<h3>Summary</h3>' +
                    '<p class="sub-note">' + escapeHtml(source) + '</p>' +
                '</div>' +
                '<button class="modal-close" onclick="closeModal()">√ó</button>' +
            '</div>' +
            '<div class="modal-body">' +
                '<div class="modal-source">üì∞ ' + escapeHtml(article.source || 'Ag News') + (time ? ' ‚Ä¢ ' + time : '') + '</div>' +
                '<h2 class="modal-title">' + escapeHtml(article.title) + '</h2>' +
                '<div class="modal-summary">' + escapeHtml(summary) + '</div>' +
            '</div>' +
            '<div class="modal-footer">' +
                '<button class="modal-btn modal-btn-secondary" onclick="closeModal()">Close</button>' +
                '<a class="modal-btn modal-btn-primary" href="' + article.link + '" target="_blank" rel="noopener">Read Full Article ‚Üí</a>' +
            '</div>';
        
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
    
    // Close modal on overlay click or Escape key
    modal.addEventListener('click', function(e) { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeModal(); });
    
    loadData();
    setInterval(loadData, 2 * 60 * 1000);
    
    async function loadForecast() {
        try {
            const res = await fetch('https://api.weather.gov/gridpoints/DLH/75,63/forecast');
            if (!res.ok) throw new Error('Forecast unavailable');
            const data = await res.json();
            const periods = data.properties.periods;
            
            const wxIcon = (forecast, isDay) => {
                const f = forecast.toLowerCase();
                if (f.includes('thunder') || f.includes('storm')) return '‚õàÔ∏è';
                if (f.includes('rain') || f.includes('shower')) return 'üåßÔ∏è';
                if (f.includes('snow') || f.includes('flurr')) return 'üå®Ô∏è';
                if (f.includes('cloud') || f.includes('overcast')) return '‚òÅÔ∏è';
                if (f.includes('partly') || f.includes('mostly sunny')) return isDay ? '‚õÖ' : 'üåô';
                if (f.includes('fog') || f.includes('mist')) return 'üå´Ô∏è';
                if (f.includes('wind')) return 'üí®';
                return isDay ? '‚òÄÔ∏è' : 'üåô';
            };
            
            if (periods[0]) {
                document.getElementById('wx-today-icon').textContent = wxIcon(periods[0].shortForecast, periods[0].isDaytime);
                document.getElementById('wx-today-temp').textContent = periods[0].temperature + '¬∞' + periods[0].temperatureUnit;
                document.getElementById('wx-today-desc').textContent = periods[0].shortForecast.substring(0, 20);
            }
            if (periods[1]) {
                document.getElementById('wx-tonight-icon').textContent = wxIcon(periods[1].shortForecast, periods[1].isDaytime);
                document.getElementById('wx-tonight-temp').textContent = periods[1].temperature + '¬∞' + periods[1].temperatureUnit;
                document.getElementById('wx-tonight-desc').textContent = periods[1].shortForecast.substring(0, 20);
            }
            if (periods[2]) {
                document.getElementById('wx-tomorrow-icon').textContent = wxIcon(periods[2].shortForecast, periods[2].isDaytime);
                document.getElementById('wx-tomorrow-temp').textContent = periods[2].temperature + '¬∞' + periods[2].temperatureUnit;
                document.getElementById('wx-tomorrow-desc').textContent = periods[2].shortForecast.substring(0, 20);
            }
            if (periods[3]) {
                document.getElementById('wx-tomnight-icon').textContent = wxIcon(periods[3].shortForecast, periods[3].isDaytime);
                document.getElementById('wx-tomnight-temp').textContent = periods[3].temperature + '¬∞' + periods[3].temperatureUnit;
                document.getElementById('wx-tomnight-desc').textContent = periods[3].shortForecast.substring(0, 20);
            }
            
            // Update morning briefing weather
            updateBriefingWeather(periods);
        } catch (e) {
            console.log('Forecast error:', e);
        }
    }
    
    loadForecast();
    setInterval(loadForecast, 30 * 60 * 1000);
    
    // ============================================
    // REPORTING THIS WEEK (from calendar data)
    // ============================================
    var calReports = [
        {d:'Jan 10',name:'WASDE',impact:'high'},
        {d:'Jan 10',name:'Crop Production Annual',impact:'high'},
        {d:'Jan 10',name:'Grain Stocks',impact:'high'},
        {d:'Feb 7',name:'Crop Production',impact:'medium'},
        {d:'Feb 11',name:'WASDE',impact:'high'},
        {d:'Feb 20',name:'Cattle on Feed',impact:'medium'},
        {d:'Feb 24',name:'Ag Outlook Forum',impact:'high'},
        {d:'Mar 11',name:'WASDE',impact:'high'},
        {d:'Mar 20',name:'Cattle on Feed',impact:'medium'},
        {d:'Mar 27',name:'Hogs & Pigs',impact:'medium'},
        {d:'Mar 31',name:'Prospective Plantings',impact:'high'},
        {d:'Mar 31',name:'Grain Stocks',impact:'high'},
        {d:'Apr 9',name:'WASDE',impact:'high'},
        {d:'Apr 13',name:'Crop Progress',impact:'medium'},
        {d:'Apr 17',name:'Cattle on Feed',impact:'medium'},
        {d:'May 12',name:'WASDE',impact:'high'},
        {d:'May 22',name:'Cattle on Feed',impact:'medium'},
        {d:'Jun 11',name:'WASDE',impact:'high'},
        {d:'Jun 19',name:'Cattle on Feed',impact:'medium'},
        {d:'Jun 25',name:'Hogs & Pigs',impact:'medium'},
        {d:'Jun 30',name:'Acreage Report',impact:'high'},
        {d:'Jun 30',name:'Grain Stocks',impact:'high'},
        {d:'Jul 11',name:'WASDE',impact:'high'},
        {d:'Jul 17',name:'Cattle on Feed',impact:'medium'},
        {d:'Aug 12',name:'WASDE',impact:'high'},
        {d:'Aug 12',name:'Crop Production',impact:'high'},
        {d:'Aug 21',name:'Cattle on Feed',impact:'medium'},
        {d:'Sep 11',name:'WASDE',impact:'high'},
        {d:'Sep 11',name:'Crop Production',impact:'high'},
        {d:'Sep 18',name:'Cattle on Feed',impact:'medium'},
        {d:'Sep 25',name:'Hogs & Pigs',impact:'medium'},
        {d:'Sep 30',name:'Grain Stocks',impact:'high'},
        {d:'Oct 10',name:'WASDE',impact:'high'},
        {d:'Oct 10',name:'Crop Production',impact:'high'},
        {d:'Oct 23',name:'Cattle on Feed',impact:'medium'},
        {d:'Nov 10',name:'WASDE',impact:'high'},
        {d:'Nov 10',name:'Crop Production',impact:'medium'},
        {d:'Nov 20',name:'Cattle on Feed',impact:'medium'},
        {d:'Dec 10',name:'WASDE',impact:'high'},
        {d:'Dec 10',name:'Crop Production',impact:'high'},
        {d:'Dec 18',name:'Cattle on Feed',impact:'medium'},
        {d:'Dec 23',name:'Hogs & Pigs',impact:'medium'},
    ];
    
    function loadReportingThisWeek() {
        var el = document.getElementById('briefing-reports');
        var now = new Date();
        var year = now.getFullYear();
        
        // Get start/end of this week (Mon-Sun) and next week
        var dayOfWeek = now.getDay();
        var mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
        var monday = new Date(now);
        monday.setDate(now.getDate() + mondayOffset);
        monday.setHours(0,0,0,0);
        
        var nextSunday = new Date(monday);
        nextSunday.setDate(monday.getDate() + 13); // this week + next week
        
        var upcoming = [];
        calReports.forEach(function(r) {
            var parts = r.d.split(' ');
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            var monthIdx = months.indexOf(parts[0]);
            var day = parseInt(parts[1]);
            if (monthIdx === -1) return;
            var rDate = new Date(year, monthIdx, day);
            if (rDate >= monday && rDate <= nextSunday) {
                upcoming.push({ name: r.name, date: r.d, impact: r.impact, dateObj: rDate });
            }
        });
        
        // Also include weekly Export Sales (Thursdays) if nothing else
        var thisThurs = new Date(monday);
        thisThurs.setDate(monday.getDate() + 3);
        if (upcoming.length === 0 || (upcoming.length < 2 && thisThurs >= now)) {
            upcoming.push({ name: 'Export Sales', date: 'Thu', impact: 'medium', dateObj: thisThurs });
        }
        
        // Sort by date
        upcoming.sort(function(a,b) { return a.dateObj - b.dateObj; });
        
        if (upcoming.length === 0) {
            el.innerHTML = '<div style="color:var(--dim);font-size:0.8rem">No major reports this week. Enjoy the quiet!</div>';
            return;
        }
        
        // Show up to 4
        var html = upcoming.slice(0, 4).map(function(r) {
            var isPast = r.dateObj < now;
            return '<div class="br-row' + (isPast ? ' style="opacity:0.5"' : '') + '">' +
                '<span class="br-name">' + r.name + '</span>' +
                '<span style="display:flex;align-items:center;gap:6px">' +
                    '<span class="br-impact ' + r.impact + '">' + r.impact.charAt(0).toUpperCase() + '</span>' +
                    '<span class="br-date">' + r.date + '</span>' +
                '</span>' +
            '</div>';
        }).join('');
        el.innerHTML = html;
    }
    
    loadReportingThisWeek();
    
    // ============================================
    // MORNING BRIEFING ‚Äî Weather + Prices
    // ============================================
    function updateBriefingWeather(periods) {
        if (!periods || !periods[0]) return;
        var p = periods[0];
        var temp = p.temperature;
        var unit = p.temperatureUnit;
        document.getElementById('bwx-temp').textContent = temp + '¬∞' + unit;
        document.getElementById('bwx-desc').textContent = p.shortForecast;
        if (p.windSpeed) {
            document.getElementById('bwx-wind').textContent = 'üí® Wind: ' + p.windSpeed + ' ' + p.windDirection;
        }
    }
    
    function getGreeting() {
        const hour = new Date().getHours();
        if (hour < 5) return 'üåô Late night';
        if (hour < 12) return '‚òÄÔ∏è Good morning';
        if (hour < 17) return 'üå§Ô∏è Good afternoon';
        if (hour < 21) return 'üåÖ Good evening';
        return 'üåô Good night';
    }
    
    function setWelcome(location) {
        const greeting = getGreeting();
        const msg = location ? `${greeting} from ${location}` : greeting;
        document.getElementById('welcome-msg').textContent = msg;
    }
    
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                fetch(`https://nominatim.openstreetmap.org/reverse?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&format=json`)
                    .then(r => r.json())
                    .then(data => {
                        const county = data.address?.county || data.address?.city || data.address?.state || '';
                        if (county) setWelcome(county);
                    })
                    .catch(() => setWelcome(''));
            },
            () => setWelcome(''),
            { timeout: 5000, maximumAge: 600000 }
        );
    } else {
        setWelcome('');
    }
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW error:', err));
    }
    </script>
</body>
</html>
